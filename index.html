<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drawing App</title>
    
	<link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.js"></script>

    <!-- Fontawsome icons: -->
    <script src=https://kit.fontawesome.com/3a0ae6b487.js></script>
</head>

<body>

<h1>Welcome to the Drawing App! (Chrome or Firefox recommended to use).</h1>
<div class= "container">

    <div class="color-container">
        <button class="btn btn-black" type="button"></button>
        <button class="btn btn-red" type="button"></button>
        <button class="btn btn-orange" type="button"></button>
        <button class="btn btn-yellow" type="button"></button>
        <button class="btn btn-green" type="button"></button>
        <button class="btn btn-blue" type="button"></button>
        <button class="btn btn-purple" type="button"></button>
        <button class="btn btn-pink" type="button"></button>
        <button class="btn btn-brown" type="button"></button>
        <button class="btn btn-grey" type="button"></button>
    </div>

    <div id="stage">
        <canvas width="700" height="500" id="main"></canvas>
        <canvas width="700" height="500" id="model"></canvas>
        <canvas width="700" height="500" id="trace"></canvas>
    </div>

    <div class="toolbar-container">
        <div class="shapes">
            <button id="circle" class="btn btn-circle" type="button" title="Circle"></button>
            <button id="ellipse" class="btn btn-ellipse" type="button" title="Ellipse"></button>
            <button id="square" class="btn btn-square" type="button" title="Rectangle"></button>
        </div>
        <div class="vgap" style="margin-bottom: 15px;"></div>
        <div class="tracer-display" id="trace">
            <div class="tracer-position">
                <label for="x" title="X coordinate">x:</label>
                <input type="text" name="x" size="2"></input>
            </div>
            <div class="tracer-position">
                <label for="y" title="X coordinate">y:</label>
                <input type="text" name="y" size="2"></input>
            </div>
            <div class="tracer-zoom">
                <label for="z" title="Zoom factor">z:</label>
                <input type="text" name="z" size="2"></input>
            </div>
        </div>
        <div class="vgap" style="margin-bottom: 15px;"></div>
        <div class="move-controls">
            <div class="move-control"></div>
            <div class="move-control">
                <button id="move-up" type="button"><i class="fas fa-angle-up"></i></button>
            </div>
            <div class="move-control"></div>

            <div class="move-control">
                <button id="move-left" type="button"><i class="fas fa-angle-left"></i></button>
            </div>
            <div class="move-control">
                <button id="move-center" type="button"><i class="fas fa-arrows-alt"></i></button>
            </div>
            <div class="move-control">
                <button id="move-right" type="button"><i class="fas fa-angle-right"></i></button>
            </div>

            <div class="move-control"></div>
            <div class="move-control">
                <button id="move-down" type="button"><i class="fas fa-angle-down"></i></button>
            </div>
            <div class="move-control"></div>
        </div>
        <div class="vgap" style="margin-bottom: 15px;"></div>
        <div class="tracer-display" id="offset">
            <div class="tracer-position">
                <label for="ox" title="Current offset by X axis">x:</label>
                <input type="text" name="ox" size="2"></input>
            </div>
            <div class="tracer-position">
                <label for="oy" title="Current offset by Y axis">y:</label>
                <input type="text" name="oy" size="2"></input>
            </div>
        </div>
        <div class="vgap" style="margin-bottom: auto;"></div>
        <div class="actions">
            <button id="clear" class="btn-clear" type="button">Clear</button>
        </div>
    </div>

</div>


<script src="include/Shape.js"></script>
<script src="include/Dispatcher.js"></script>
<script src="include/Layer.js"></script>
<script src="include/Stage.js"></script>
<script src="include/MouseTracker.js"></script>
<script src="include/jquery.mousewheel.js"></script>
    

<script>

    var stage = new Stage(
        $("#stage").find("#main").get(0), 
        $("#stage").find("#model").get(0), 
        $("#stage").find("#trace").get(0));

    var dispatcher = new Dispatcher(stage);
    var shape = new Shape();
    var color = undefined;

    $(document).ready( () => {
        
        /**
         * Make this looking fancier.
         * with some sort of JQuery UI plugin.
         */
        $("#move-center")
            .css('cursor','pointer')
            .attr("title", "Use buttons to drag the drawing over the canvas, or drag it with middle mouse-button down");
        
        /**
         * For each color button attach click handler:
         * onClick make button's width wider, so that it was seen that
         * the color-button has been clicked.
         */
        $.each($('.color-container').find(".btn"), (index, button) => {
            $(button).on("click", (event) => {
                $.each($('.color-container').find(".btn"), (index, button) => { 
                    if ($(event.target).attr("class") == $(button).attr("class")) {
                        $(button).css("width", "40px");
                        $(button).blur();
                        color = $(button).css("background-color");
                        shape.setColor(color);
                    } else {
                        $(button).css("width", "30px");
                    }
                });

            });
        });

        /**
         * box-shadow decoration for the selected shape button:
         */
        $.each($('.shapes').find(".btn"), (index, button) => { 
            $(button).on("click", (event) => {
                $.each($('.shapes').find(".btn"), (index, button) => {
                    if ($(event.target).attr("id") == $(button).attr("id")) {
                        $(button).css("box-shadow", "0 0 1px #51abff, 0 0 2px #51abff, 0 0 6px #51abff, 0 0 12px #51abff");
                        $(button).blur();
                    } else {
                        $(button).css("box-shadow", "");
                    }
                });

            });
        });

        /**
         * Trigger clisk event at black=color button, 
         * to pick black color as default.
         */
        $('.color-container').find(".btn.btn-black").click();
       
        /**
         * Event handlers for shape-buttons
         */
        $("#circle").on("click", (event) => {
            shape = new Circle();
            shape.setColor(color);
        });

        $("#ellipse").on("click", (event) => {
            shape = new Ellipse();
            shape.setColor(color);
        });

        $("#square").on("click", (event) => {
            shape = new Rectangle();
            shape.setColor(color);
        });

        $("#clear").on("click", (event) => {
            stage.clearAndReset();
        });
    
        /**
         * Trace the mouse pointer and process its "mousemove" and "click" events:
         */
        $("#trace").on("mousemove", (event) => {
            dispatcher.dispatch(event, shape);
        });

        $("#trace").on("click mousewheel", (event) => {
            dispatcher.dispatch(event, shape);
        });

        $("#trace").on("mousedown mouseup mouseover mouseout", (event) => {
            dispatcher.dispatch(event, shape);
        });

        /**
         * Trace ESC key-up event
         */
        $(document).on("keyup", (event) => {
            if (event.key === "Escape") {
                dispatcher.dispatch(event, shape);
            }
        });

        /**
         * Dragging with buttons:
         */

        $("input[name='ox']").val(0);
        $("input[name='oy']").val(0);

        $("#move-up").on("click", () => {
            stage.drag(0, -50);
        });

        $("#move-down").on("click", () => {
            stage.drag(0, 50);
        });

        $("#move-left").on("click", () => {
            stage.drag(-50, 0);
        });

        $("#move-right").on("click", () => {
            stage.drag(50, 0);
        });

        $("#move-center").on("click", () => {
             stage.center();
        });

    });
</script>
</body>
</html>